# lbj-dynamicproxy 动态代理

    增强对象的功能：
    设计模式：一些通用的解决固定问题的方式
    代理模式
    概念：
    （1）. 真实对象：被代理的对象
    （2）. 代理对象：
    （3）. 代理模式：代理对象代理真实对象，达到增强真实对象功能的目的
    实现方式：
    （1）. 静态代理：有一个类文件描述代理模式
    （2）. 动态代理：在内存中形成代理类


    动态代理分为两种，一种是JDK反射机制提供的代理，另一种是CGLIB代理。
    在JDK代理，必须提供接口，而CGLIB则不需要提供接口，
    在JDK动态代理中提供一个Proxy类来创建代理类，而在CGLib动态代理中也提供了一个类似的类Enhancer；

    
## JDK动态代理
    
### 实现
    ①. 代理对象和真实对象实现相同的接口
    ②. 代理对象 = Proxy.newProxyInstance();
    ③. 使用代理对象调用方法。
    ④. 增强方法

## CGLib

    CGLIB代理主要通过对字节码的操作，为对象引入间接级别，以控制对象的访问。我们知道Java中有一个动态代理也是做这个事情的，那我们为什
    么不直接使用Java动态代理，而要使用CGLIB呢？答案是CGLIB相比于JDK动态代理更加强大，JDK动态代理虽然简单易用，但是其有一个致命缺陷
    是，只能对接口进行代理。如果要代理的类为一个普通类、没有接口，那么Java动态代理就没法使用了。

### 实现

    Enhancer可能是CGLIB中最常用的一个类，和Java1.3动态代理中引入的Proxy类差不多(如果对Proxy不懂，可以参考这里)。
    和Proxy不同的是，Enhancer既能够代理普通的class，也能够代理接口。Enhancer创建一个被代理对象的子类并且拦截所有的方法调用
    （包括从Object中继承的toString和hashCode方法）。Enhancer不能够拦截final方法，例如Object.getClass()方法，
    这是由于Java final方法语义决定的。基于同样的道理，Enhancer也不能对fianl类进行代理操作。
    这也是Hibernate为什么不能持久化final class的原因。

### 应用
    应用于AOP框架（Spring、dynaop）中，用以提供方法拦截操作。Hibernate作为一个比较受欢迎的ORM框架，同样使用CGLIB来代理单端
    （多对一和一对一）关联（延迟提取集合使用的另一种机制）
    在Mybatis里两种动态代理技术都已经使用了，在Mybatis中通常在延迟加载的时候才会用到CGLIB动态代理。

