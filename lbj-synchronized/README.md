# Synchronized底层实现

## 版本
    早期，jdk早期时，这个synchronized是底层实现是重量级的，是要找操作系统去申请锁的地步，效率较低。
    改进后有了锁升级的概念
    
## 锁升级
    
    Hotsop的实现是这样的：上来之后的第一个去访问某把锁的线程，比如synchronized(object)，来了之后现在这个object的头上markword记录
    这个线程。如果只有第一个线程访问的时候实际上是没有给这个object加锁的，在内部实现的时候，只是记录这个线程的ID（偏向锁）
    
    偏向锁如果有线程的争用的话，就会升级为自旋锁。自旋锁，是指当线程发现对象头的markword有记录时，不会跑到cpu的就绪队列中，而是用一
    个while循环一直等着占用cpu。
    
    当自旋的次数超过10次，升级为重量级锁，去操作系统中申请资源。
    
    
## 特性

    锁的是对象而不是代码。可以锁定this或xx.class。
    
    锁定方法和非锁定方法可以同时运行。
    
    锁可以重入。  
    

## 与CAS的区别

    需要注意：并不是CAS的效率就一定比系统锁高，这个要根据实际情况进行区分：
    
    1、执行时间短（加锁代码），线程数少，用自旋锁。
    2、执行时间长，线程较多，用系统锁。  
    



